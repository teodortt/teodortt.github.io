<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4f46e5" id="themeColor">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>BG Euro Hub</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-sec: #6b7280;
            --accent: #4f46e5;
            --accent-soft: #eef2ff;
            --border: #e5e7eb;
            --success: #10b981;
            --danger: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #111827 0%, #1f2937 100%);
            --card-bg: #1f2937;
            --text-main: #f9fafb;
            --text-sec: #9ca3af;
            --accent: #818cf8;
            --accent-soft: #312e81;
            --border: #374151;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 16px;
            color: var(--text-main);
        }

        .container {
            width: 100%;
            max-width: 480px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh; /* Mobile app feel */
            max-height: 800px;
        }

        /* Header & Tabs */
        .header {
            padding: 20px 20px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title { font-weight: 800; font-size: 1.25rem; display: flex; align-items: center; gap: 8px; }
        
        .theme-btn {
            background: none; border: none; cursor: pointer; color: var(--text-main);
            padding: 8px; border-radius: 50%; background: var(--border);
        }

        .tabs {
            display: flex;
            padding: 0 16px;
            gap: 8px;
            margin-bottom: 16px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-sec);
            font-weight: 600;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
            background: var(--accent-soft);
            border-radius: 8px 8px 0 0;
        }

        /* Scrollable Content */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px 20px;
            display: none; /* Hidden by default */
        }
        
        .content-area.active { display: block; animation: fadeIn 0.3s ease; }

        /* Inputs */
        .input-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        .label {
            font-size: 0.85rem;
            color: var(--text-sec);
            margin-bottom: 6px;
            display: block;
            font-weight: 500;
        }

        .input-field {
            width: 100%;
            padding: 16px;
            font-size: 1.25rem;
            background: var(--bg-gradient);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-main);
            font-weight: 700;
            outline: none;
        }

        .input-field:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2); }
        
        .currency-badge {
            position: absolute;
            right: 16px;
            top: 42px;
            font-weight: 700;
            color: var(--text-sec);
        }

        /* Sections */
        .card-section {
            background: var(--bg-gradient);
            padding: 16px;
            border-radius: 12px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        /* History */
        .history-list {
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        .history-item:last-child { border: none; }
        .history-time { color: var(--text-sec); font-size: 0.8rem; }

        /* Payment Mode Styles */
        .payment-summary {
            text-align: center;
            padding: 20px;
            border-radius: 16px;
            margin-top: 20px;
            background: var(--text-main); /* Inverted */
            color: var(--card-bg);
        }
        
        .change-amount {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        .status-ok { background: var(--success); color: white; }
        .status-warn { background: var(--danger); color: white; }

        /* Buttons */
        .btn-row { display: flex; gap: 10px; margin-top: 20px; }
        
        .btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-primary { background: var(--accent); color: white; }
        .btn-outline { border: 1px solid var(--border); background: transparent; color: var(--text-main); }
        .btn-clear { color: var(--danger); font-size: 0.8rem; float: right; cursor: pointer; }

        /* Utility */
        .swap-container { display: flex; justify-content: center; margin: -10px 0 10px; position: relative; z-index: 5; }
        .swap-btn { background: var(--accent); color: white; width: 40px; height: 40px; border-radius: 50%; border: 4px solid var(--card-bg); cursor: pointer; display: flex; align-items: center; justify-content: center; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="title">
            <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>
            BG Euro Hub
        </div>
        <button class="theme-btn" onclick="toggleTheme()">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('converter')">–ö–æ–Ω–≤–µ—Ä—Ç–æ—Ä</button>
        <button class="tab-btn" onclick="switchTab('payment')">–ö–∞—Å–∞ / –†–µ—Å—Ç–æ</button>
    </div>

    <!-- TAB 1: CONVERTER -->
    <div id="converter" class="content-area active">
        
        <div class="input-wrapper">
            <label class="label" id="lblTop">–°—É–º–∞ –≤ –ï–≤—Ä–æ</label>
            <input type="number" id="inpTop" class="input-field" placeholder="0" inputmode="decimal" value="100">
            <span class="currency-badge" id="curTop">EUR</span>
        </div>

        <div class="swap-container">
            <div class="swap-btn" onclick="swapConverter()">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M7 16V4M7 4L3 8M7 4L11 8M17 8V20M17 20L21 16M17 20L13 16"/></svg>
            </div>
        </div>

        <div class="input-wrapper">
            <label class="label" id="lblBottom">–°—É–º–∞ –≤ –õ–µ–≤–∞</label>
            <input type="number" id="inpBottom" class="input-field" placeholder="0" inputmode="decimal" readonly>
            <span class="currency-badge" id="curBottom">BGN</span>
        </div>

        <div class="btn-row">
            <button class="btn btn-outline" onclick="copyResult()">–ö–æ–ø–∏—Ä–∞–π</button>
            <button class="btn btn-primary" onclick="saveToHistory()">–ó–∞–ø–∞–∑–∏</button>
        </div>

        <!-- History Section -->
        <div class="card-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span class="label" style="margin:0;">üìú –ò—Å—Ç–æ—Ä–∏—è</span>
                <span class="btn-clear" onclick="clearHistory()">–ò–∑—á–∏—Å—Ç–∏</span>
            </div>
            <div id="historyList" class="history-list">
                <!-- History items injected here -->
                <div style="text-align:center; color:var(--text-sec); padding:10px; font-size:0.9rem;">–ù—è–º–∞ —Å–∫–æ—Ä–æ—à–Ω–∏ –∑–∞–ø–∏—Å–∏</div>
            </div>
        </div>
    </div>

    <!-- TAB 2: MIXED PAYMENT -->
    <div id="payment" class="content-area">
        <div class="input-wrapper">
            <label class="label">–î—ä–ª–∂–∏–º–∞ —Å—É–º–∞ (–°–º–µ—Ç–∫–∞)</label>
            <input type="number" id="billAmount" class="input-field" placeholder="0.00" inputmode="decimal">
            <span class="currency-badge">BGN</span>
        </div>

        <div style="display:flex; gap:10px;">
            <div class="input-wrapper" style="flex:1;">
                <label class="label">–î–∞–≤–∞—Ç (EUR)</label>
                <input type="number" id="payEur" class="input-field" placeholder="0" inputmode="decimal">
            </div>
            <div class="input-wrapper" style="flex:1;">
                <label class="label">–î–∞–≤–∞—Ç (BGN)</label>
                <input type="number" id="payBgn" class="input-field" placeholder="0" inputmode="decimal">
            </div>
        </div>

        <div class="payment-summary" id="paymentResult">
            <div id="paymentStatus" class="status-badge status-warn">–ß–∞–∫–∞ –≤—ä–≤–µ–∂–¥–∞–Ω–µ</div>
            <div style="margin-top:10px; font-size:0.9rem; opacity:0.8;">–†–µ—Å—Ç–æ –∑–∞ –≤—Ä—ä—â–∞–Ω–µ:</div>
            <div class="change-amount" id="changeBgn">0.00 <span style="font-size:1rem">–ª–≤</span></div>
            <div style="font-size:0.9rem;">‚âà <span id="changeEur">0.00</span> ‚Ç¨</div>
        </div>
        
        <div class="btn-row">
             <button class="btn btn-outline" onclick="resetPayment()">–ù–æ–≤–∞ —Å–º–µ—Ç–∫–∞</button>
        </div>
    </div>

</div>

<script>
    const RATE = 1.95583;
    let isEurToBgn = true;
    
    // --- THEME & INIT ---
    function init() {
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('themeColor').setAttribute('content', '#111827');
        }
        renderHistory();
        // Trigger default calculation
        calcConverter();
    }

    function toggleTheme() {
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        const newTheme = isDark ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.theme = newTheme;
        document.getElementById('themeColor').setAttribute('content', newTheme === 'dark' ? '#111827' : '#4f46e5');
    }

    function switchTab(tabId) {
        document.querySelectorAll('.content-area').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        // Find button by onclick attribute (simple hack)
        const btns = document.querySelectorAll('.tab-btn');
        if(tabId === 'converter') btns[0].classList.add('active');
        else btns[1].classList.add('active');
    }

    // --- CONVERTER LOGIC ---
    const inpTop = document.getElementById('inpTop');
    const inpBottom = document.getElementById('inpBottom');

    function calcConverter() {
        const val = parseFloat(inpTop.value);
        if (isNaN(val)) {
            inpBottom.value = '';
            return;
        }
        const res = isEurToBgn ? val * RATE : val / RATE;
        inpBottom.value = res.toFixed(2);
    }

    function swapConverter() {
        isEurToBgn = !isEurToBgn;
        
        // Swap UI Labels
        document.getElementById('lblTop').innerText = isEurToBgn ? '–°—É–º–∞ –≤ –ï–≤—Ä–æ' : '–°—É–º–∞ –≤ –õ–µ–≤–∞';
        document.getElementById('lblBottom').innerText = isEurToBgn ? '–°—É–º–∞ –≤ –õ–µ–≤–∞' : '–°—É–º–∞ –≤ –ï–≤—Ä–æ';
        document.getElementById('curTop').innerText = isEurToBgn ? 'EUR' : 'BGN';
        document.getElementById('curBottom').innerText = isEurToBgn ? 'BGN' : 'EUR';

        // Swap Values
        const oldTop = inpTop.value;
        inpTop.value = inpBottom.value;
        calcConverter(); // Recalculate based on new top
    }

    inpTop.addEventListener('input', calcConverter);

    // --- HISTORY LOGIC ---
    function getHistory() {
        return JSON.parse(localStorage.getItem('calcHistory') || '[]');
    }

    function saveToHistory() {
        const val1 = inpTop.value;
        const cur1 = document.getElementById('curTop').innerText;
        const val2 = inpBottom.value;
        const cur2 = document.getElementById('curBottom').innerText;

        if(!val1 || !val2) return;

        const history = getHistory();
        const entry = {
            txt: `${val1} ${cur1} ‚ûù ${val2} ${cur2}`,
            time: new Date().toLocaleTimeString('bg-BG', {hour: '2-digit', minute:'2-digit'})
        };

        // Prevent duplicates at top
        if(history.length > 0 && history[0].txt === entry.txt) return;

        history.unshift(entry);
        if(history.length > 10) history.pop(); // Keep last 10
        
        localStorage.setItem('calcHistory', JSON.stringify(history));
        renderHistory();
        
        // Visual feedback
        const btn = document.querySelector('.btn-primary');
        const oldText = btn.innerText;
        btn.innerText = "–ó–∞–ø–∞–∑–µ–Ω–æ!";
        setTimeout(() => btn.innerText = oldText, 1000);
    }

    function renderHistory() {
        const list = document.getElementById('historyList');
        const history = getHistory();
        
        if (history.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:var(--text-sec); padding:10px; font-size:0.9rem;">–ù—è–º–∞ —Å–∫–æ—Ä–æ—à–Ω–∏ –∑–∞–ø–∏—Å–∏</div>';
            return;
        }

        list.innerHTML = history.map(h => `
            <div class="history-item">
                <span>${h.txt}</span>
                <span class="history-time">${h.time}</span>
            </div>
        `).join('');
    }

    function clearHistory() {
        localStorage.removeItem('calcHistory');
        renderHistory();
    }

    function copyResult() {
        const txt = `${inpBottom.value} ${document.getElementById('curBottom').innerText}`;
        navigator.clipboard.writeText(txt);
        alert('–ö–æ–ø–∏—Ä–∞–Ω–æ: ' + txt);
    }

    // --- MIXED PAYMENT LOGIC ---
    const billInput = document.getElementById('billAmount');
    const payEurInput = document.getElementById('payEur');
    const payBgnInput = document.getElementById('payBgn');
    
    function calcPayment() {
        const bill = parseFloat(billInput.value) || 0;
        const givenEur = parseFloat(payEurInput.value) || 0;
        const givenBgn = parseFloat(payBgnInput.value) || 0;

        if (bill === 0 && givenEur === 0 && givenBgn === 0) return;

        // Convert everything the customer gave to BGN base
        const totalGivenInBgn = givenBgn + (givenEur * RATE);
        const difference = totalGivenInBgn - bill;

        const statusEl = document.getElementById('paymentStatus');
        const changeBgnEl = document.getElementById('changeBgn');
        const changeEurEl = document.getElementById('changeEur');
        const resultBox = document.getElementById('paymentResult');

        if (difference >= -0.009) { // Handle float precision, basically >= 0
            // Success: Give Change
            statusEl.innerText = "–†–ï–°–¢–û";
            statusEl.className = "status-badge status-ok";
            resultBox.style.background = "var(--text-main)";
            
            changeBgnEl.innerText = difference.toFixed(2) + " –ª–≤";
            changeEurEl.innerText = (difference / RATE).toFixed(2);
        } else {
            // Insufficient funds
            const remaining = Math.abs(difference);
            statusEl.innerText = "–û–°–¢–ê–í–ê–¢ –î–ê –°–ï –ü–õ–ê–¢–Ø–¢";
            statusEl.className = "status-badge status-warn";
            resultBox.style.background = "#fee2e2"; // Light red alert
            if (document.documentElement.getAttribute('data-theme') === 'dark') {
                resultBox.style.background = "#7f1d1d"; 
            }

            changeBgnEl.innerText = remaining.toFixed(2) + " –ª–≤";
            changeEurEl.innerText = (remaining / RATE).toFixed(2);
        }
    }

    function resetPayment() {
        billInput.value = '';
        payEurInput.value = '';
        payBgnInput.value = '';
        document.getElementById('changeBgn').innerText = '0.00 –ª–≤';
        document.getElementById('changeEur').innerText = '0.00';
        document.getElementById('paymentStatus').innerText = '–ß–∞–∫–∞ –≤—ä–≤–µ–∂–¥–∞–Ω–µ';
        document.getElementById('paymentStatus').className = "status-badge status-warn";
        document.getElementById('paymentResult').style.background = "var(--text-main)";
    }

    [billInput, payEurInput, payBgnInput].forEach(el => el.addEventListener('input', calcPayment));

    // Start
    init();

</script>
</body>
</html>

